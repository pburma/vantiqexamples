# Hello World HTTP Tutorial

Quick start guide for working with the Vantiq platform using a http rest API post to send data into the Vantiq platform. 

Steps

* [Start the Vantiq server using a docker image](#starting-the-docker-image)
* [Sign in and create a Hello World namespace](#sign-into-vantiq-and-create-a-new-namespace)
* [Generate an access token for external rest calls](#create-an-access-token)
* [Use curl/postman/python/javascript to generate a rest call to a Vantiq topic](#post-data-to-a-vantiq-topic-over-http)
  * [Curl Example](#curl-example)
  * [Postman Example](#postman-example)
  * [Python Example](#python-example)
  * [Javascript Example](#javascript-example)
* [View the data post from inside Vantiq](#view-incoming-data)
* [Create an application to save data to mongo](#create-application-save-results-to-mongo)
* [Create a simple web client to view stored data and real-time incoming events](#create-simple-web-client)

## Starting the Docker image

Make sure you have installed docker and docker-compose first the continue on to these steps. 

1. Open a terminal/shell window and create a folder called vantiq-server
```
mkdir vantiq-server
cd vantiq server
```
2. Download this [docker-compose.yml](https://github.com/pburma/vantiqexamples/blob/master/docker_examples/vantiq_edge_simple/docker-compose.yml) file into the vantiq-server folder. 
3. Copy the Vantiq license keys into the vantiq-server folder. If you do not have license keys contact support@vantiq.com to request them. 
4. Start the docker compose configuration
```
docker-compose up -d
```

## Sign into Vantiq and create a new namespace
1. Open a browser and browse to [http://localhost:8080](http://localhost:8080)
2. Login using the default Vantiq admin login. 
Username: system
Password: <this will be provided by vantiq support>
3. Click the checkboxes to accept the license agreement terms. 
4. Go to Administer --> Namespaces and select the New button
5. Provide a Namespace name "HelloWorld" 
6. Click the Make Me the Administrator checkbox or enter an Administrator username and password which will create a new user (requires you logout and log back in as the new user after completion)
7. Click the save icon in the top right corner
8. Click on the namespace name "system" in the top right corner and switch to the HelloWorld namespace, if you created a new user then log out as by clicking on the profile icon in the top right corner. Logging back in as the new user will automatically enter you into the HelloWorld namespace. 

## Create an access token

1. Go to Administer --> Advanced --> Access Tokens and click the New button
2. Provide a name and expiration date for the access token. Make sure the expiration date is set to some time in the future, the default expiration will be 30 days from now. 
3. Clicking on the access token in the table in will copy the token to your clipboard, keep this handy as we will use it to authenticate our http post to Vantiq in the next section. 

## Post data to a Vantiq topic over http
Send data to Vantiq using one of the following methods. 
*Notice the double slash in the URL is intentional and indicates the path of an internal Vantiq topic /helloworld/in.*
### Curl Example
curl -X POST "http://localhost:8080/api/v1/resources/topics//helloworld/in" -H "Authorization: Bearer <your vantiq access token>" -H "Content-Type:application/json" --data-raw "{\"value\":\"101\", \"id\":\"HelloWorld\"}"

Response true will indicate it is working.
 
Query Params instead of headers. 
It is possible to use query paramter in the URL instead of auth headers. For that just add the token parameter to the URL. 
http://localhost:8080/api/v1/resources/topics//helloworld/in?token=<auth-token>

To send a body you still need to use a POST, if you use the GET method you will get the details of the topic back as the response if one is defined.

### Postman Example
* POST URL: http://localhost:8080/api/v1/resources/topics//helloworld/in
* Authorization: Set to bearer and provide the access token you created in Vantiq
* Body: Set to "raw" mode and paste in the following. 
```
{"value":"102", "id":"HelloWorld"}
```
* Click the Send button.

Response true will indicate it is working.
### Python Example
*Autogenerated from postman*
```
import http.client
import json

conn = http.client.HTTPSConnection("localhost", 8080)
payload = json.dumps({
  "value": "102",
  "id": "HelloWorld"
})
headers = {
  'Authorization': 'Bearer <your vantiq access token>',
  'Content-Type': 'application/json'
}
conn.request("POST", "/api/v1/resources/topics//helloworld/in", payload, headers)
res = conn.getresponse()
data = res.read()
print(data.decode("utf-8"))
```


### Javascript Example
*Autogenerated from postman*
```
var settings = {
  "url": "http://localhost:8080/api/v1/resources/topics//helloworld/in",
  "method": "POST",
  "timeout": 0,
  "headers": {
    "Authorization": "Bearer <your vantiq access token>",
    "Content-Type": "application/json"
  },
  "data": JSON.stringify({
    "value": "102",
    "id": "HelloWorld"
  }),
};

$.ajax(settings).done(function (response) {
  console.log(response);
});
```

## View incoming data 
1. Inside Vantiq go to Add --> Advanced --> Topic
2. Click on the blue New Topic button
3. Provide the name "/helloworld/in" and click OK to save
4. Inside the topic window click on the "Test Data Receipt" button, the "Data From" window will now display the latest event to come through this topic. 
5. Execute the rest command again from curl/postman/python/javascript and the results will appear in the Data From window

## Create Application, save results to mongo

* Go to Add --> Advanced --> App
* Provide the name HelloWorld for the app and click OK
![image](https://user-images.githubusercontent.com/11183903/156262720-41f27cd2-0bf5-4ee6-9fd9-587aaaa675c2.png)
* Click on the orange box added to the app canvas
* On the properties pane to the right name this box "Initiate"
* Select the Click To Edit text on the right properties pane to open the Configuration details
* Change the inboundResource to "topics" and the inboundResourceId to "/helloworld/in" which should appear in the droplist. 
![image](https://user-images.githubusercontent.com/11183903/156262799-92010cab-3c9c-4172-a44a-39ee7e36bdc3.png)
* Click OK to save and notice the orange box is now yellow to indicate a the application is monitoring events that arrive on this topic. 
![image](https://user-images.githubusercontent.com/11183903/156262858-a3fa9ad3-f879-4ace-81ba-4682d4d3abf3.png)
* Select the View Task Events bar on the properties pane and send in another HelloWorld event to the system you will see it appear here. If you click on the value that shows up you can pull up an expanded view.
![image](https://user-images.githubusercontent.com/11183903/156262898-82b5e451-e252-45dd-a194-2a7ee4890613.png)
* Click on the green button that says "Create Data Type"
* Change the name to hellodata and the Type Role to "standard" then click Save. This adds a Type which provides a used defined schema in mongo we can save data to. 
![image](https://user-images.githubusercontent.com/11183903/156263155-2117951d-fbf9-4f38-a70b-ee1231b587df.png)
* Right click on the Initiate yellow box and select Link New Task
* From the list of activity patterns select Filter
* Set the name as Over100 and click OK
* Select the blue diamond Over100 filter you added and in the properties pane select the Click To Edit text to open the configuration details. 
* Set the condition to 
```
toInteger(event.value) > 100
```
The incoming data is automatically assigned the variable name "event", this means the id and value are referenced as event.id and event.value. Since the value is coming in as a string we will also convert it to an integer which is necessary for this type of conditional expression. 
![image](https://user-images.githubusercontent.com/11183903/156263076-a21df725-fd64-4c43-8950-3436988c5e15.png)
* Right click on the Filter activity and select Link New Task again. 
* Select the SaveToType activity pattern. 
* Choose the hellodata Type from the droplist and click OK
![image](https://user-images.githubusercontent.com/11183903/156263185-ab9d1b22-95c6-4e69-993f-da5502726565.png)
* Save the application by clicking on the disk icon in the top right corner. 
* Send in another HelloWorld event to the system and notice the badge decorations. These indicate the steps that have been executed by the incoming event. 
![image](https://user-images.githubusercontent.com/11183903/156263215-37d6672d-4896-49b8-b180-779a22ba8019.png)
* Notice that all three steps should show a badge decoration, if not then either double check the previous steps and make sure the value in your HelloWorld data is over 100. 
* To view the data added into the system we can view the records in the Type one way to do this is to pull up the Type itself. To do this expand the "Type" category in the left most navigation pane and select hellodata. 
* If you click on the Properties tab you can see the schema keys that were automatically setup by our Create Type action earlier. 
![image](https://user-images.githubusercontent.com/11183903/156263263-9e7b1d6f-4003-47f6-9e4a-8551e6dc6bc8.png)
* Click on the Show All Records to see the stored data set. 
![image](https://user-images.githubusercontent.com/11183903/156263274-d994497f-3cec-4514-9060-b33900c26e0d.png)

 
## Create simple web client
